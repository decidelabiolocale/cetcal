/* *****************************************************
 * Setups.
 * ****************************************************/
$('.carousel').carousel();

function scrollTowards(id) {
	$('html, body').animate({
	    scrollTop: ($('#' + id).offset().top)
	}, 1200);
}

function scrollTowardsId(id, additional) {
	$('html, body').animate({
	    scrollTop: ($('#' + id).offset().top + additional)
	}, 1200);
}

$(document).ready(function() {
	
	$('a.scrolltowards').click(function(e) {
		e.preventDefault();
		$("html, body").animate({ scrollTop: $($(this).attr("href")).offset().top - 120 }, 500);
	});
	$('#cet-notre-projet').on('mousedown', function(e) {
    $('#modal-cet-notre-projet-btn').click(); 
  });
  $('#cet-notre-projet-union-eu').on('mousedown', function(e) {
    $('#modal-cet-notre-projet-btn').click();
  });
  $('#cet-notre-projet-region').on('mousedown', function(e) {
    $('#modal-cet-notre-projet-btn').click();
  });
  $('.cet-conditions-donnees-numerique').on('mousedown', function(e) {
    $('#modal-cet-vos-donnees-btn').click();
  });    
  $('#cet-annuaire-crt-recherche-btn').on('mousedown', function(e) {
    $('#cet-qstprod_seconnecter').hide('slow');
    $('#cet-annuaire-crt-main-container').fadeIn('slow');
    cetcrtmainmap.setView([44.854, -0.043], 10);
  });
  $('#cet-inscription-producteur').on('mousedown', function(e) {
    $('#cet-qstprod_intro').fadeIn('slow');
    scrollTowardsId('cet-qstprod_intro', -18);
  });
  $('#open-recherche-avancee-cetcal').on('mousedown', function(e) {
    $('#modal-cet-recherche-avancee-btn').click(); 
  });

  /** *********************************************************************************************************
   * Responsive custom functions.
   */
  $(window).width() <= 700 ? $('div.hidden-infeq-700').hide() : $('div.hidden-infeq-700').show();
  $(window).width() > 700 ? $('#cet-navbar-hamburger').addClass('margin-80-infeq-700') : 
  	$('#cet-navbar-hamburger').removeClass('margin-80-infeq-700');
  $(window).resize(function() {
		$(window).width() <= 700 ? $('div.hidden-infeq-700').fadeOut() : $('div.hidden-infeq-700').fadeIn();
		$(window).width() > 700 ? $('#cet-navbar-hamburger').addClass('margin-80-infeq-700') : 
  		$('#cet-navbar-hamburger').removeClass('margin-80-infeq-700');
	});
	$(window).width() > 700 ? $('#crt-search-libelle').html('Rechercher votre commune et trouver vos producteur.e.s') : 
		$('#crt-search-libelle').html('>');
	$(window).width() > 700 ? $('#valider-recherche-commune-cartographie').html('Rechercher') : 
		$('#valider-recherche-commune-cartographie').html('<i class="fa fa-search" aria-hidden="true"></i>');
	$(window).width() > 700 ? $('#cet-annuaire-recherche-communes-value').attr('placeholder', '') : 
		$('#cet-annuaire-recherche-communes-value').attr('placeholder', 'rechercher des communes');
	$(window).resize(function() {
		$(window).width() > 700 ? $('#crt-search-libelle').html('Rechercher votre commune et trouver vos producteur.e.s') : 
			$('#crt-search-libelle').html('>');
		$(window).width() > 700 ? $('#valider-recherche-commune-cartographie').html('Rechercher') : 
			$('#valider-recherche-commune-cartographie').html('<i class="fa fa-search" aria-hidden="true"></i>');
		$(window).width() > 700 ? $('#cet-annuaire-recherche-communes-value').attr('placeholder', '') : 
			$('#cet-annuaire-recherche-communes-value').attr('placeholder', 'rechercher des communes');
	});
	/* *********************************************************************************************************/
	
  if($('#cet-qstprod_err-genrique').length == 0) {
  } else {
    scrollTowardsId('cet-qstprod_err-genrique', -18);
  }

  $(document).prop('title', 'Annuaire des producteurs bio de la région castillon');

});

$(document).on("keydown", "form", function(event) { 
    return event.key != "Enter";
});

function lireLaSuite(classref) {
  $('.' + classref).show('slow');
}

/* ****************************************************
 * Copier Coller dans le presse papier.
 * ****************************************************/
function copierPressePapier(data) {
	copyTextToClipboard(data);
}

function fallbackCopyTextToClipboard(text) {
  var textArea = document.createElement("textarea");
  textArea.value = text;
  
  // Avoid scrolling to bottom
  textArea.style.top = "0";
  textArea.style.left = "0";
  textArea.style.position = "fixed";

  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();

  try {
    var successful = document.execCommand('copy');
    var msg = successful ? 'successful' : 'unsuccessful';
    //console.log('Fallback: Copying text command was ' + msg);
  } catch (err) {
    console.error('Fallback: Oops, unable to copy', err);
    return false;
  }

  document.body.removeChild(textArea);
  return true;
}
function copyTextToClipboard(text) {
  if (!navigator.clipboard) {
    fallbackCopyTextToClipboard(text);   	
  }
  navigator.clipboard.writeText(text).then(function() {
    //console.log('Async: Copying to clipboard was successful!');
  }, function(err) {
    console.error('Async: Could not copy text: ', err);
  });

	$('input.copier-element-presse-papier-input').each(function() {
		if ($(this).val() === text) {
			$(this).css('background-color', 'lightyellow');
		} else {
			$(this).css('background-color', 'white');
		}
	}); 
}

function pasteToInput(id)
{
  var outputElem = document.getElementById(id);
  navigator.clipboard.readText().then(text => outputElem.value = text);
  $('#' + id).addClass('is-valid');
}

/* ****************************************************
 * Form checking.
 * ****************************************************/
function checkFormInput(maxl, id) {
	var l = $('#' + id).val().length;
	if (l > 1 && l <= maxl) { 
		displayValidFormInput(id);
	} else { 
		displayInvalidFormInput(id); 
	}
	return;
}

function checkFormInputInteger(maxl, minl, id) {
	var l = $('#' + id).val().length;
	if ((l >= minl && l <= maxl) && $.isNumeric($('#' + id).val())) { 
		displayValidFormInput(id);
	} else { 
		displayInvalidFormInput(id); 
	}
	return;
}

function checkFormInputMin(maxl, minl, id) {
	var l = $('#' + id).val().length;
	if (l > 1 && l <= maxl && l >= minl) { 
		displayValidFormInput(id);
	} else { 
		displayInvalidFormInput(id); 
	}
	return;
}

function checkSiret(id) {
	var l = $('#' + id).val().length;
	if (l === 14 && $.isNumeric($('#' + id).val())) { 
		displayValidFormInput(id);
	} else { 
		if (l > 0) {
			$('#modal-questionaire-titre').text('N° de SIRET invalid');
			$('#modal-questionaire-paragraphe').text("Le siret saisie n'est pas un siret valide. Un Siret comporte 14 chiffres et aucune lettre ou caractère. Veuillez rectifier votre saisie.");
			$('#modal-questionaire-btn-primary').text("J'ai compris");
			$('#modal-questionaire-btn').click(); 
		}
	}
	return; 
}

function checkMotsDePasse(maxl, minl, id, idconf) {
	var mdp = $('#' + id).val();
	var mdpconf = $('#' + idconf).val();
	if ((mdp.length >= minl && mdpconf.length > 0) && mdp != mdpconf) {
		displayInvalidFormInput(idconf);
		$('#modal-questionaire-titre').text('Mots de passe non identiques');
		$('#modal-questionaire-paragraphe').text("Le mot de passe de confirmation de correspond pas au mot de passe saisie. Veuillez vérifier vos saisies. Le mot de passe doit contenir au minimum 8 caractères.");
		$('#modal-questionaire-btn-primary').text("J'ai compris");
		$('#modal-questionaire-btn').click();
		return;
	} else {
		checkFormInputMin(maxl, minl, idconf);
	}
}

function checkValidEmail(maxl, id) {
	var l = $('#' + id).val().length;
	var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
	if (regex.test($('#' + id).val()) && l <= maxl) {
		displayValidFormInput(id);
	} else {
		displayInvalidFormInput(id);
	} 
}

function checkFRDateFormat(obl, id) {

	var l = $('#' + id).val().length;
	if (!obl && l <= 0) { 
		removeValidInvalidDisplay(id);
		return;
	}

	var date = $('#' + id).val();
	var regex = /^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$/;
	if (regex.test(date) && l == 10 && l == 10) {
		displayValidFormInput(id);
	} else {
		displayInvalidFormInput(id);
		if (l > 0) {
			$('#modal-questionaire-titre').text('Probléme avec la date "' + date + '"');
			$('#modal-questionaire-paragraphe').text("Le format de la date doit être de type jour/mois/année. Veuillez vérifier votre saiaie.");
			$('#modal-questionaire-btn-primary').text("J'ai compris");
			$('#modal-questionaire-btn').click();
		}
	}  
}

function checkValidEmailConfirmation(maxl, id, idconf) {

	if ($('#' + idconf).val().length === 0 && $('#' + id).val().length === 0) { 
		displayInvalidFormInput(id); 
    displayInvalidFormInput(idconf);
    return; 
	} else {
		if ($('#' + id).val() !== $('#' + idconf).val() && $('#' + idconf).val().length > 0) {
			displayInvalidFormInput(idconf);
			$('#modal-questionaire-titre').text('E-mails non identiques');
			$('#modal-questionaire-paragraphe').text("L'e-mail de confirmation de correspond pas à l'e-mail saisie. Veuillez vérifier vos saisies.");
			$('#modal-questionaire-btn-primary').text("J'ai compris");
			$('#modal-questionaire-btn').click();
		} else {
			var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
			if ($('#' + idconf).val().length > 0 && regex.test($('#' + id).val()) && 
          regex.test($('#' + idconf).val())) {
				addValidInput(id);
				addValidInput(idconf);
        displayValidFormInput(id);
        displayValidFormInput(idconf);
			} else {
				displayInvalidFormInput(idconf);
				$('#modal-questionaire-titre').text('Erreur sur saisie E-mail');
				$('#modal-questionaire-paragraphe').text("L'e-mail saisie contient une erreur. Veuillez vérifier vos saisies.");
				$('#modal-questionaire-btn-primary').text("J'ai compris");
				$('#modal-questionaire-btn').click();
			}
		}
	}
}

function addValidInput(id) {
	$('#' + id).addClass('is-valid');
}

function clearValidInput(id) {
	$('#' + id).removeClass('is-valid');
}

function displayInvalidFormInput(id) {
	$('#' + id).removeClass('is-valid');
	$('#' + id).addClass('is-invalid'); 
}

function displayValidFormInput(id) {
	$('#' + id).removeClass('is-invalid');
	$('#' + id).addClass('is-valid'); 
}

function removeValidInvalidDisplay(id) {
	$('#' + id).removeClass('is-invalid');
	$('#' + id).removeClass('is-valid');
}